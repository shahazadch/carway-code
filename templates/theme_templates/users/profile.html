{% load static %}
{% load crispy_forms_tags %}
<!DOCTYPE html>
<html lang="en" data-bs-theme="light" data-pwa="true">
  <head>
    <meta charset="utf-8">

    <!-- Viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, viewport-fit=cover">

    <!-- SEO Meta Tags -->
    <title>CarWay | My Profile</title>
    <meta name="description" content="CarWay - The best place to buy and sell cars online">
    <meta name="keywords" content="car dealer, car marketplace, car sale, used cars, new cars">
    <meta name="author" content="CarWay Team">

    <!-- Webmanifest + Favicon / App icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="manifest" href="{% static 'theme/manifest.json' %}">
    <link rel="icon" type="image/png" href="{% static 'theme/app-icons/icon-32x32.png' %}" sizes="32x32">
    <link rel="apple-touch-icon" href="{% static 'theme/app-icons/icon-180x180.png' %}">

    <!-- Theme switcher (color modes) -->
    <script src="{% static 'theme/js/theme-switcher.js' %}"></script>

    <!-- Preloaded local web font (Inter) -->
    <link rel="preload" href="{% static 'theme/fonts/inter-variable-latin.woff2' %}" as="font" type="font/woff2" crossorigin>

    <!-- Font icons -->
    <link rel="preload" href="{% static 'theme/icons/finder-icons.woff2' %}" as="font" type="font/woff2" crossorigin>
    <link rel="stylesheet" href="{% static 'theme/icons/finder-icons.min.css' %}">

    <!-- Vendor styles -->
    <link rel="stylesheet" href="{% static 'theme/vendor/swiper/swiper-bundle.min.css' %}">

    <!-- Bootstrap + Theme styles -->
    <link rel="preload" href="{% static 'theme/css/theme.min.css' %}" as="style">
    <link rel="preload" href="{% static 'theme/css/theme.rtl.min.css' %}" as="style">
    <link rel="stylesheet" href="{% static 'theme/css/theme.min.css' %}" id="theme-styles">
  </head>


  <!-- Body -->
  <body>

    <!-- Navigation bar (Page header) -->
    <header class="navbar navbar-expand-lg bg-body navbar-sticky sticky-top z-fixed px-0" data-sticky-element>
      <div class="container">

        <!-- Mobile offcanvas menu toggler (Hamburger) -->
        <button type="button" class="navbar-toggler me-3 me-lg-0" data-bs-toggle="offcanvas" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar brand (Logo) -->
        <a class="navbar-brand py-1 py-md-2 py-xl-1 me-2 me-sm-n4 me-md-n5 me-lg-0" href="{% url 'home' %}">
          <span class="d-flex flex-shrink-0 text-primary rtl-flip me-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="35" height="34"><path d="M34.5 16.894v10.731c0 3.506-2.869 6.375-6.375 6.375H17.5h-.85C7.725 33.575.5 26.138.5 17c0-9.35 7.65-17 17-17s17 7.544 17 16.894z" fill="currentColor"/><g fill-rule="evenodd"><path d="M17.5 13.258c-3.101 0-5.655 2.554-5.655 5.655s2.554 5.655 5.655 5.655 5.655-2.554 5.655-5.655-2.554-5.655-5.655-5.655zm-9.433 5.655c0-5.187 4.246-9.433 9.433-9.433s9.433 4.246 9.433 9.433a9.36 9.36 0 0 1-1.569 5.192l2.397 2.397a1.89 1.89 0 0 1 0 2.671 1.89 1.89 0 0 1-2.671 0l-2.397-2.397a9.36 9.36 0 0 1-5.192 1.569c-5.187 0-9.433-4.246-9.433-9.433z" fill="#000" fill-opacity=".05"/><g fill="#fff"><path d="M17.394 10.153c-3.723 0-6.741 3.018-6.741 6.741s3.018 6.741 6.741 6.741 6.741-3.018 6.741-6.741-3.018-6.741-6.741-6.741zM7.347 16.894A10.05 10.05 0 0 1 17.394 6.847 10.05 10.05 0 0 1 27.44 16.894 10.05 10.05 0 0 1 17.394 26.94 10.05 10.05 0 0 1 7.347 16.894z"/><path d="M23.025 22.525c.645-.645 1.692-.645 2.337 0l3.188 3.188c.645.645.645 1.692 0 2.337s-1.692.645-2.337 0l-3.187-3.187c-.645-.646-.645-1.692 0-2.337z"/></g></g><path d="M23.662 14.663c2.112 0 3.825-1.713 3.825-3.825s-1.713-3.825-3.825-3.825-3.825 1.713-3.825 3.825 1.713 3.825 3.825 3.825z" fill="#fff"/><path fill-rule="evenodd" d="M23.663 8.429a2.41 2.41 0 0 0-2.408 2.408 2.41 2.41 0 0 0 2.408 2.408 2.41 2.41 0 0 0 2.408-2.408 2.41 2.41 0 0 0-2.408-2.408zm-5.242 2.408c0-2.895 2.347-5.242 5.242-5.242s5.242 2.347 5.242 5.242-2.347 5.242-5.242 5.242-5.242-2.347-5.242-5.242z" fill="currentColor"/></svg>
          </span>
          CarWay
        </a>

        <!-- Main navigation that turns into offcanvas on screens < 992px wide (lg breakpoint) -->
        <nav class="offcanvas offcanvas-start" id="navbarNav" tabindex="-1" aria-labelledby="navbarNavLabel">
          <div class="offcanvas-header py-3">
            <h5 class="offcanvas-title" id="navbarNavLabel">Browse CarWay</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body pt-2 pb-4 py-lg-0 mx-lg-auto">
            <ul class="navbar-nav position-relative">
              <li class="nav-item">
                <a class="nav-link" href="{% url 'home' %}">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="{% url 'listing-list' %}">Cars</a>
              </li>
              {% if user.is_authenticated %}
              <li class="nav-item">
                <a class="nav-link" href="{% url 'listing-create' %}">Sell Your Car</a>
              </li>
              {% endif %}
            </ul>
          </div>
        </nav>

        <!-- User account dropdown -->
        <div class="dropdown d-inline-block ms-auto">
          {% if user.is_authenticated %}
          <a class="dropdown-toggle d-inline-flex align-items-center fs-sm ms-md-2 fw-medium text-decoration-none text-body" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fi-user fs-xl me-1"></i>
            {{ user.username }}
          </a>
          <ul class="dropdown-menu dropdown-menu-end" style="min-width: 10.5rem">
            <li>
              <a class="dropdown-item" href="{% url 'profile' %}">
                <i class="fi-user opacity-75 me-2"></i>
                My profile
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="{% url 'user-listings' user.username %}">
                <i class="fi-layers opacity-75 me-2"></i>
                My listings
              </a>
            </li>
            <li>
              <a class="dropdown-item" href="{% url 'inbox' %}">
                <i class="fi-chat-left opacity-75 me-2"></i>
                Messages
              </a>
            </li>
            <li><hr class="dropdown-divider"></li>
            <li>
              <a class="dropdown-item" href="{% url 'logout' %}">
                <i class="fi-log-out opacity-75 me-2"></i>
                Sign out
              </a>
            </li>
          </ul>
          {% else %}
          <a class="btn btn-sm btn-primary d-lg-inline-flex" href="{% url 'login' %}">
            <i class="fi-user me-2"></i>
            Sign in
          </a>
          {% endif %}
        </div>
      </div>
    </header>


    <!-- Page content -->
    <main class="container py-4 py-xl-5 mb-2">
      <div class="row g-4 g-xl-5">

        <!-- Sidebar -->
        <aside class="col-lg-3 col-xl-3">
          <!-- Account navigation -->
          <div class="card bg-border shadow-sm mb-4">
            <div class="card-body">
              <h5 class="d-flex align-items-center mb-0">
                <span class="fs-base">{{ user.username }}</span>
              </h5>
              <p class="fs-sm text-body-secondary mb-0">Member since {{ user.date_joined|date:"F d, Y" }}</p>
              <div class="border-bottom mb-3 pb-3"></div>
              <nav class="list-group list-group-borderless">
                <a class="list-group-item list-group-item-action d-flex align-items-center active" href="{% url 'profile' %}">
                  <i class="fi-user fs-base opacity-75 me-2"></i>
                  My profile
                </a>
                <a class="list-group-item list-group-item-action d-flex align-items-center" href="{% url 'user-listings' user.username %}">
                  <i class="fi-car fs-base opacity-75 me-2"></i>
                  My listings
                </a>
                <a class="list-group-item list-group-item-action d-flex align-items-center" href="{% url 'inbox' %}">
                  <i class="fi-chat-left fs-base opacity-75 me-2"></i>
                  Messages
                </a>
              </nav>
              <nav class="list-group list-group-borderless pt-3">
                <a class="list-group-item list-group-item-action d-flex align-items-center" href="{% url 'logout' %}">
                  <i class="fi-log-out fs-base opacity-75 me-2"></i>
                  Sign out
                </a>
              </nav>
            </div>
          </div>
        </aside>


        <!-- Account profile content -->
        <div class="col-lg-9">
          <h1 class="h2 pb-2 pb-lg-3">My profile</h1>

          <!-- Activity summary -->
          <section class="row g-3 g-xl-4 pb-5 mb-md-3">
            <div class="col-md-6 col-lg-5 col-xl-6">
              <div class="card bg-primary-subtle border-0 h-100">
                <div class="card-body">
                  <h3 class="fs-sm fw-normal mb-2">My Listings</h3>
                  <div class="h4 mb-0">{{ user.carlisting_set.count }}</div>
                </div>
                <div class="card-footer bg-transparent border-0 pt-0 pb-4 mt-n2 mt-sm-0">
                  <a class="position-relative d-inline-flex align-items-center fs-sm fw-medium text-primary text-decoration-none" href="{% url 'user-listings' user.username %}">
                    <span class="hover-effect-underline stretched-link">View all listings</span>
                    <i class="fi-chevron-right fs-base ms-1"></i>
                  </a>
                </div>
              </div>
            </div>
            <div class="col-md-6 col-lg-7 col-xl-6">
              <div class="card bg-warning-subtle border-0 h-100">
                <div class="card-body">
                  <h3 class="fs-sm fw-normal mb-2">Messages</h3>
                  <div class="h4 mb-0">{{ user.conversations.count }}</div>
                </div>
                <div class="card-footer bg-transparent border-0 pt-0 pb-4 mt-n2 mt-sm-0">
                  <a class="position-relative d-inline-flex align-items-center fs-sm fw-medium text-warning text-decoration-none" href="{% url 'inbox' %}">
                    <span class="hover-effect-underline stretched-link">View messages</span>
                    <i class="fi-chevron-right fs-base ms-1"></i>
                  </a>
                </div>
              </div>
            </div>
          </section>

          <!-- Profile settings -->
          <section class="mb-5">
            <div class="card bg-body shadow-sm">
              <div class="card-body">
                <div class="vstack gap-4">
                  {% if messages %}
                    {% for message in messages %}
                      <div class="alert {% if message.tags %}alert-{{ message.tags }}{% else %}alert-info{% endif %} alert-dismissible fade show">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                      </div>
                    {% endfor %}
                  {% endif %}

                  <!-- Profile info tab -->
                  <div>
                    <h2 class="h4 card-header-title">
                      Personal info
                    </h2>
                    <div class="border-bottom my-3"></div>
                    
                    <!-- Form -->
                    <form class="needs-validation" method="POST" enctype="multipart/form-data" novalidate>
                      {% csrf_token %}
                      <div class="row row-cols-1 row-cols-sm-2 g-4 mb-4">
                        <!-- Username / Email fields rendered with Crispy Forms -->
                        <div class="col position-relative">
                          {{ u_form.username|as_crispy_field }}
                        </div>
                        <div class="col position-relative">
                          {{ u_form.email|as_crispy_field }}
                        </div>
                      </div>
                      
                      <div class="row row-cols-1 row-cols-sm-2 g-4 mb-4">
                        <!-- Phone / Location fields rendered with Crispy Forms -->
                        <div class="col position-relative">
                          {{ p_form.phone_number|as_crispy_field }}
                        </div>
                        <div class="col position-relative">
                          {{ p_form.location|as_crispy_field }}
                        </div>
                      </div>
                      
                      <div class="border-top pt-4">
                        <button type="submit" class="btn btn-lg btn-primary">Save changes</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
    </main>


    <!-- Footer -->
    <footer class="footer bg-body text-body pt-5 pb-4">
      <div class="container">
        
        <!-- Divider -->
        <hr class="mt-4 mb-0">
        
        <!-- Copyright and footer links -->
        <div class="row pt-4">
          <div class="col-md-6 col-lg-5 order-md-1 mb-md-0 mb-4">
            <p class="fs-sm mb-0">&copy; {% now "Y" %} CarWay. All rights reserved.</p>
          </div>
          <div class="col-md-6 col-lg-7 order-md-2">
            <ul class="nav justify-content-md-end">
              <li class="nav-item">
                <a class="nav-link fs-sm" href="#">Privacy Policy</a>
              </li>
              <li class="nav-item">
                <a class="nav-link fs-sm" href="#">Terms & Conditions</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </footer>


    <!-- Bootstrap + Theme scripts -->
    <script src="{% static 'theme/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js' %}"></script>
    <script src="{% static 'theme/vendor/swiper/swiper-bundle.min.js' %}"></script>
    <script src="{% static 'theme/vendor/simplebar/dist/simplebar.min.js' %}"></script>
    <script src="{% static 'theme/js/theme.min.js' %}"></script>
  </body>
</html>